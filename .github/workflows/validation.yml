name: changelog

on: push
  # pull_request:
  #   branches: 
  #     - main
  #   paths:
  #     - 'mod-assets/**'

jobs:    
  scan-for-changelog:
    runs-on: ubuntu-latest
    steps:
      - name: "Looking for changelog update"
        uses: brettcannon/check-for-changed-files@v1
        with:
          file-pattern: "CHANGELOG.md"
          skip-label: "No Updates?"
          failure-message: "Expected CHANGELOG.md to have an update"

  ini-validation:
    runs-on: ubuntu-latest
    steps:
    - name: "Set up Python environment"
      run: | 
        python -m pip install tqdm

    - name: Cache HD Edition
      id: cache-hd-edition
      uses: actions/cache@v4
      with:
        key: hd-cache
        path: ${{ github.workspace }}/freelancer-hd-edition/*
        restore-keys: hd-cache

    - name: "Clone Freelancer HD Edition"
      run: |  
        git clone https://github.com/BC46/freelancer-hd-edition.git
        

    - name: "Checkout repository"
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        path: staging 
    
    - name: "Run validation.py"
      run: |
        cd ${{ github.workspace }}/staging
        export FL_PATH="${{ github.workspace }}/freelancer-hd-edition/EXE"
        python ${{ github.workspace }}/staging/build-tools/python/validation.py 2>/dev/null
    